<html>
  <head>
    <script src="http://code.jquery.com/jquery-2.0.0.js"></script>
    <script src='../lib/underscore-min.js'></script>
    <script src='../lib/underscoreAddon.js'></script>
    <script src="../src/PykUtil.js"></script>
    <script src="../src/PykQuery.js"></script>
    <script src="../src/PykQuery.adapter.inbrowser.js"></script>
  </head>
  <body>
    <h3>Testing #1: Filters with two tables</h3>
    <div id="g1">
      <div id='a' style="float:left;margin-left:100px;"></div>
      <div id='b' style="float:left;margin-left:100px;"></div>
    </div>
    <script type="text/javascript">

      var xmlhttp = new XMLHttpRequest();
      var url = "data/test1data.json";
      xmlhttp.onreadystatechange = function () {
        if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {

          g1 = new PykQuery.init("global", "global", "g1", "inbrowser");
          g1.storeObjectInMemory('g1');
          g1.rawdata = JSON.parse(xmlhttp.response);
          g1.addImpacts(["a", "b"], true);

          var d = a.call().getData();
          var e = b.call().getData();
          console.log(d,e,"FFFFFFFFFFFF");
          var html1 = "<table><tr><td>City</td><td>Price</td></tr>";
          for (var i = 0; i< d.length; i++) {
            html1 += "<tr><td>"+d[i].city+"</td><td>"+d[i].price+"</td></tr>"
          }
          html1 += "</table>";

          var html2 = "<table><tr><td>City</td><td>Price</td></tr>";
          for (var i = 0; i< e.length; i++) {
            html2 += "<tr><td>"+e[i].zip+"</td><td>"+e[i].beds+"</td></tr>"
          }
          html2 += "</table>";

          document.getElementById(a.div_id).innerHTML = html1;
          document.getElementById(b.div_id).innerHTML = html2;
        }
      }
      xmlhttp.open("GET", url, true);
      xmlhttp.send();

      var a = new PykQuery.init("aggregation", "local", "a", "inbrowser");
      a.storeObjectInMemory('a');
      a.dimensions = ["city"];
      a.metrics = {"price":["sum"]}//, {"sd": ["min"]}, {"sd": ["min"]}];

      var b = new PykQuery.init("aggregation", "local", "b", "inbrowser");
      b.storeObjectInMemory('b');
      b.dimensions = ["zip"];
      b.metrics = {"beds":["count"]}//, {"sd": ["min"]}, {"sd": ["min"]}];

      // z = a.filter();
      // z.add({"column_name": "price", "condition_type": "range", "condition": {"min": 59222, "max": 110700, "not": false}, "next": "OR"});
      // // z = b.filter()
      // // z.add({"column_name": "Daysdsd", "condition_type": "range", "condition": {"min": 10000, "max": 210000, "not": false}, "next": "OR"});
      // z = g1.filter()
      // z.add({"column_name": "Name", "condition_type": "values", "in": ["Darpan", "Ronak"], "next": "OR"});
    </script>
  </body>
</html>
