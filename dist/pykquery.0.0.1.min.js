PykUtil={},PykUtil.init=function(){this.pushToArray=function(b,c){return b=a.length?a.push(c):[c]},this.concatAndUniq=function(a,b){return void 0!=a&&void 0!=b&&(a=a.concat(b).filter(function(a,b,c){return c.indexOf(a)===b})),a},this.isExactlySame=function(a,b){if(a&&b){var c=a.length===b.length&&a.every(function(a,c){return _.isEqual(a,b[c])});return c}return!1},this.subtractArray=function(a,b){if(a&&b){if(0===a.length)return a=void 0;for(var c=b.length,d=0;c>d;d++){var e=a.indexOf(b[d]);if(e>-1&&a.splice(e,1),0===a.length)return a=void 0}}return a},this.subtractObjectAttribute=function(a,b){if(a&&b){if(0===Object.keys(a).length)return a=void 0;for(var c=b.length,d=0;c>d;d++)if(a[b[d]]&&delete a[b[d]],0===Object.keys(a).length)return a=void 0}return a},this.isBlank=function(a){return a?!1:!0}};var PykQuery={};PykQuery.connector_names=[],PykQuery.node_names=[],PykQuery.query_json={};var queryjson={},query_restore=!0,restoreFilters=function(){for(var a in PykQuery.query_json){for(var b,c=PykQuery.query_json[a],d=window[a],e=c.length,f=0;e>f;f++)b="node"===d.scope?!1:!0,d.addFilter([c[f]],b,!0,d.nodedividtriggeringevent,!0);if(0===e&&"connector"===d.scope){var g=document.getElementsByClassName("filter_list");if(g.length>0){var h=g[0].parentNode.id;d.listFilters(h)}}}};Object.defineProperty(PykQuery,"query_json",{get:function(){return queryjson},set:function(a){queryjson=a,query_restore&&restoreFilters()}});var setQueryJSON=function(a,b,c){PykQuery.query_json[a]=c};PykQuery.init=function(a,b,c,d){function e(a,b,c,d,e){for(var f=!1,g=U.length,h=a.length,i=!0,j=0;h>j;j++){var k=a[j],l=k.length,m=document.querySelectorAll("[data-id='"+k[0].selected_dom_id+"']");if(l>1){for(var o=0;l-1>o;o++)k[o].group=!0;k[l-1].group=!1}if(0===g)U.push(k),f=!0,i=!1;else{for(var p=!1,q=0;g>q;q++){var r=J.isExactlySame(k,U[q]),s=J.isExactlySame(k,U[q]);if(s&&r){P(2,"Clean up your JS: Same filter cannot add"),p=!0;break}}if(p)break;if(m.length>0&&m[0].classList.contains("pykquery-selected")&&!k.override_filter);else{for(var t=!1,u=0;l>u;u++)for(var v=k[u],w=!1,x=0;g>x;x++){var y=U[x],z=y.length;if(n(v)){for(var A=0;z>A;A++){var B=y[A],C=B.column_name,D=B.condition_type;if(C===v.column_name&&D===v.condition_type)if("values"===D||"datatype"===D){var E=J.isExactlySame(v.not_in,B["in"]),F=J.isExactlySame(v["in"],B.not_in);if(v.override_filter&&(E||F)){U[x][A]=v,eb=!1,w=!0,t=!0;break}}else if("range"===D){var G=v.condition,H=B.condition;if(G.min===H.min&&G.max===H.max&&G.not===H.not){P(2,"Clean up your JS: Same filter cannot add");break}if(v.override_filter){U[x][A]=v,eb=!1,w=!0,t=!0;break}}}if(w){i=!1;break}}}t||(U.push(k),f=!0,i=!1)}}}i?d.removeFilter(a,b,c):(f===!0?d&&"connector"===d.scope&&c&&d.call():!eb&&c&&d.call(),query_restore=e,e||setQueryJSON(d.div_id,d.scope,U),query_restore=!0),f=g=h=i=null}function f(a,b){for(var c=a.length,d=0;c>d;d++)for(var e=a[d],f=e.length,g=0;f>g;g++)e[g].node_div_id_triggering_event=u;if("node"===w)for(var h=$.length,g=0;h>g;g++)window[$[g]].addFilter(a,!0,b,u)}function g(a,b,c){for(var d=b.filters,e=d.length,f=a.length,g=!1,h=0;f>h;h++){for(var i=a[h],j=i.length,k=!1,l=0;e>l;l++){var m=J.isExactlySame(i,d[l]),o=J.isExactlySame(i,d[l]);if(o&&m){d.splice(l,1),g=!0,k=!0;break}}if(!k&&1===j)for(var p=0;j>p;p++){var q=i[p];if(column_name=q.column_name,condition_type=q.condition_type,n(q))for(var r=e-1;r>=0;r--){var s=d[r],t=s.length;if(1===t)for(var u=t-1;u>=0;u--){var v=s[u],w=v.column_name,x=v.condition_type;if(w===column_name&&x===condition_type)if("values"===condition_type||"datatype"===condition_type)0===_.difference(v.in,q.in).length&&0===_.difference(v.not_in,q.not_in).length&&(s.splice(u,1),0===s.length&&d.splice(r,1),g=!0);else if("range"===condition_type){var y=q.condition.min,z=q.condition.max;K(y)||K(z)||y===v.condition.min&&z===v.condition.max&&(s.splice(u,1),0===s.length&&d.splice(r,1),g=!0)}}}}}b&&g&&c&&b.call(),query_restore=!1,setQueryJSON(b.div_id,b.scope,d)}function h(a,b,c){for(var d=a.length,e=0;d>e;e++)for(var f=a[e],g=f.length,h=0;g>h;h++)f[h].node_div_id_triggering_event=u;if("node"===w){for(var i=$.length,h=0;i>h;h++)window[$[h]].removeFilter(a,b,c);i=null}}function i(a,b){for(var c=U.length,d=a.length,e=0;d>e;e++)j(a[e],b),U=_.reject(U,function(b){for(var c=b.length,d=0;c>d;d++)return b[d].column_name==a[e]});U.length!==c&&(document.getElementsByClassName(u+"-filter_list").length>0&&s(),b.call()),c=d=null}function j(a,b){var c=b.alias,d=b.select,e=b.sort;if(c&&delete c[a],d){var f=d.indexOf(a);f>-1&&d.splice(f,1)}e&&(e=_.reject(e,function(b){return Object.keys(b)[0]==a}))}function k(a,b,c){var d=a.filters;if("node"===w){var e=a.dimensions,f=a.metrics,g=a.alias,h=a.select,i=a.sort;if(e){var j=e.indexOf(b);j>-1&&(e[j]=c)}if(f&&f[b]&&(f[c]=f[b],delete f[b]),g&&g[b]&&(g[b]=g[c],delete g[b]),h){var k=h.indexOf(b);k>-1&&(h[k]=c)}if(i)for(var l=i.length,m=0;l>m;m++)i[m][b]&&(i[m][c]=i[m][b],delete i[m][b])}if(d)for(var n=d.length,m=0;n>m;m++)d[m].column_name===b&&(d[m].column_name=c,document.getElementsByClassName(u+"-filter_list").length>0&&s())}function l(a,b){a.connector_divid_for_raw_data||(a.connector_divid_for_raw_data=b)}function m(a){var b,c,d=a.length;"node"===w?(error_code=13,b="connector"):(error_code=7,b="node");for(var e=0;d>e;e++)if(c=window[a[e]],c&&c.scope===w)return O(error_code,"A "+w+" can only impact a "+b),!1;return!0}function n(a){{var b=a.next;a.condition_type}return 0===Object.keys(a).length?(O(14,"Empty filter object is not allowed"),!1):K(a.column_name)?(O(15,"'column_name' cannot be empty"),!1):K(b)||"OR"===b||"AND"===b?"range"===a.condition_type?K(a.condition)?(O(17,"'condition' cannot be empty"),!1):K(a.condition.min)&&K(a.condition.max)?(O(18,"Either 'min' or 'max' or both must always be present"),!1):!0:"values"===a.condition_type||"datatype"===a.condition_type?K(a.not_in)&&K(a["in"])?(O(19,"Either 'in' or 'not_in' or both must always be present with array of some value"),!1):void 0!==a.not_in&&void 0!==a["in"]&&0===a.not_in.length&&0===a["in"].length?(O(19,"Either 'in' or 'not_in' or both must always be present with array of some value"),!1):!0:(O(20,u+": 'condition_type' must be one of "+["range","values","datatype"]),!1):(O(16,"'next' must either be empty or OR or AND"),!1)}function o(a){var b=["sum","count","min","max","avg","median","countOfUnique"];if(0===Object.keys(a).length)return O(21,"'metrics' object cannot be empty"),!1;for(var c in a){if(K(c))return O(22,"Column name is undefined in 'metrics'"),!1;if(K(a[c])||0===a[c].length)return O(23,"Please pass an Array of aggregation functions for column name '"+c),!1;for(var d=a[c].length,e=0;d>e;e++)if(b.indexOf(a[c][e])<=-1)return O(24,"Wrong aggregation function passed for column name '"+c),!1}return!0}function p(){for(var a,b,c,d,e=_.flatten(window[u].filters),f=(e.length,ab.length),g=0;f>g;g++){a=window[ab[g]].filters,b=a.length;for(var h=0;b>h;h++){c=a[h],d=c.length;for(var i=0;d>i;i++)c[i]&&c[i].node_div_id_triggering_event!==u&&e.push(c[i])}}return e}function q(){var a=E.length,b=[],c=[],d=[];if(Object.keys(PykQuery.query_json).length>0&&(d=[]),E&&E.length>0){d=[];for(var e=0;a>e;e++)E[e].hasOwnProperty("group")?b.push(E[e]):c.push(E[e]);var f=_.groupBy(c,function(a){return a.hasOwnProperty("group")?void 0:a.column_name+"-"+a.condition_type});for(var g in f){var h=f[g],i=h.length,j={column_name:h[0].column_name,condition_type:h[0].condition_type,node_div_id_triggering_event:h[0].node_div_id_triggering_event,next:h[0].next};if(h[0].hasOwnProperty("group")&&(j.group=h[0].group),"values"===h[0].condition_type||"datatype"===h[0].condition_type){for(var k=[],l=[],m=0;i>m;m++)k=h[m].in?L(k,h[m].in):k,l=h[m].not_in?L(l,h[m].not_in):l;j.in=k,j.not_in=l}else if("range"===h[0].condition_type){j.condition=[];for(var m=0;i>m;m++)j.condition.push({min:h[m].condition.min,max:h[m].condition.max,not:h[m].condition.not})}d.push(j)}}return b.concat(d)}function r(a){for(var b={},c=Object.getOwnPropertyNames(a),d=c.length,e=0;d>e;e++)a.propertyIsEnumerable(c[e])===!1&&(b[c[e]]=a[c[e]]);return b}function s(){var a=document.getElementsByClassName(u+"-filter_list")[0],b=U.length,c="";a.innerHTML="";for(var d=0;b>d;d++){for(var e=U[d],f=e.length,g="",h=0;f>h;h++){var i=e[h];if(c=h!==f-1?i.next:"",i.in)g+="<b>"+e[h].column_name+" IN</b> ("+i.in+") <i>"+c+" </i>";else if(i.not_in)g+="<b>"+e[h].column_name+" NOT IN</b> ("+i.not_in+")";else if(i.condition){var j="";i.condition.not&&(j="NOT"),g+="<b>"+e[h].column_name+" "+j+" BETWEEN</b> "+i.condition.min.toFixed(2)+" <b>AND</b> "+i.condition.max.toFixed(2)}}var k=document.createElement("div");k.setAttribute("class",u+"-filter_block"),k.setAttribute("style","padding: 0px 10px;"),k.setAttribute("id",u+"_filter_block"+d),a.appendChild(k);var l=document.createElement("div");l.setAttribute("class",u+"-filter_value"),l.innerHTML=g,document.getElementById(u+"_filter_block"+d).appendChild(l);var m=document.createElement("div");m.setAttribute("class",u+"-filter_remove"),m.setAttribute("id",u+"_filter_remove_"+d),m.innerHTML="<b class='glyphicon glyphicon-trash' style='font-size: 11px;cursor:pointer'></b>",document.getElementById(u+"_filter_block"+d).appendChild(m)}for(var n=document.getElementsByClassName(u+"-filter_remove"),o=n.length,d=0;o>d;d++)n[d].onclick=function(){var a=this.id.split("_");t(U[a[3]])}}function t(a){var b=a[0].node_div_id_triggering_event;window[b].removeFilter([a],!0,!0)}var u,v,w,x,y,z,A,B,C=this,D=d,E=[],F=["aggregation","unique","select","datatype","connector"],G=["node","connector"],H=["inbrowser","db"],I=["csv","json","array"],J=new PykUtil.init,K=J.isBlank,L=J.concatAndUniq,M=J.subtractArray,N=J.subtractObjectAttribute,O=function(a,b){var c="";100>a&&(c="Visit http://0.0.0.0:4567/#error_"+a),console.error("%c[Error - PykQuery] ","color: red;font-weight:bold;font-size:14px",'("'+b+'"). '+c)},P=function(a,b){console.warn("%c[Warning - PykQuery] ","color: #F8C325;font-weight:bold;font-size:14px",'("'+b+'"). Visit http://0.0.0.0:4567/#warning_'+a)};if(!(F.indexOf(a)>-1&&G.indexOf(b)>-1&&!K(c)&&H.indexOf(d)>-1))return-1===F.indexOf(a)&&O(2,c+": mode has invalid value. It should be one of "+F),-1===G.indexOf(b)&&O(3,c+": scope has invalid value. It should be one of "+G),-1===H.indexOf(d)&&O(4,c+": adapters has invalid value. It should be one of "+H),K(c)&&O(5,c+": DivID cannot be undefined"),!1;if(v=a,w=b,x=d,u="node"===w?c.replace("#",""):c,y="connector"===w?_.find(PykQuery.connector_names,function(a){return a===u}):null,z="node"===w?_.find(PykQuery.node_names,function(a){return a===u}):null,"connector"==v&&"connector"!=w)return O(1,u+": scope and mode both should be connector"),!1;if(void 0==y&&"connector"==w)PykQuery.connector_names.push(u),flag=!0;else{if(void 0!=z||"node"!=w)return flag=!1,!1;PykQuery.node_names.push(u),flag=!0}var Q,R,S,T,U=[],V=[],W={},X=[],Y=[],Z=2e3,$=[],ab=[],bb=0,cb={},db=[],eb=!0;switch(this.executeOnFilter=function(){},"connector"===v&&"connector"===w&&"inbrowser"===x&&Object.defineProperty(this,"rawdata",{get:function(){return R},set:function(a){R=a}}),"node"===w&&"inbrowser"===x&&Object.defineProperty(this,"connector_divid_for_raw_data",{get:function(){return S},set:function(a){S=a}}),"db"===x&&(Object.defineProperty(this,"tablename",{get:function(){return D},set:function(a){D=a}}),Object.defineProperty(this,"dataformat",{get:function(){return T},set:function(a){I.indexOf(a.toLowerCase())>-1?T=a:O(6,"The accepted data formats are csv, json and array only. Kindly set a valid data format")}})),Object.defineProperty(this,"scope",{get:function(){return w}}),v){case"select":Object.defineProperty(this,"select",{get:function(){return X},set:function(a){X=a}});break;case"aggregation":Object.defineProperty(this,"dimensions",{get:function(){return V},set:function(a){V=L(V,a)}}),Object.defineProperty(this,"metrics",{get:function(){return W},set:function(a){if(o(a))for(var b in a)W[b]=a[b]}});break;case"unique":Object.defineProperty(this,"unique",{get:function(){return X},set:function(a){_.each(a,function(a){X.push(a)})}});break;case"datatype":"datatype"===v&&"node"===w&&"db"===x&&Object.defineProperty(this,"datatype",{get:function(){return db},set:function(a){db=L(db,a)}})}Object.defineProperty(this,"div_id",{get:function(){return u}}),Object.defineProperty(this,"nodedividtriggeringevent",{get:function(){return A},set:function(a){A=a}}),Object.defineProperty(this,"limit",{get:function(){return Z},set:function(a){Z=a}}),Object.defineProperty(this,"mode",{get:function(){return v}}),Object.defineProperty(this,"offset",{get:function(){return bb},set:function(a){bb=a}}),Object.defineProperty(this,"impacts",{get:function(){return $},set:function(a){m(a)&&$.push(a)}}),Object.defineProperty(this,"impactedby",{get:function(){return ab},set:function(a){ab.push(a)}}),Object.defineProperty(this,"alias",{get:function(){return cb},set:function(a){if(columns=Object.keys(a),columns.length<1)return void P(1,"Need atleast 1 alias name to add.");for(var b in a)cb[b]=a[b]}}),Object.defineProperty(this,"sort",{get:function(){return Y},set:function(a){for(var b=a.length,c=0;b>c;c++){var d=Object.keys(a[c])[0],e=Y.length,f=!1;if(K(d))return void O(8,"Column name is undefined in sort");(K(a[c][d])||"asc"!=a[c][d]&&"desc"!=a[c][d])&&(a[c][d]="asc");for(var g=0;e>g;g++)if(Y[g][d]){Y[g][d]=a[c][d],f=!0;break}f||(Y=L(Y,a))}}}),Object.defineProperty(this,"filters",{get:function(){return U},set:function(a){U=a}}),this.addFilter=function(a,b,c,d,g){b&&"connector"===w?(e(a,b,c,this,g),document.getElementsByClassName(u+"-filter_list").length>0&&s()):b&&"node"===w?f(a,c):b||"node"!==w||e(a,b,c,this,g)},this.removeFilter=function(a,b,c){b&&"connector"===w?(g(a,this,c),document.getElementsByClassName(u+"-filter_list").length>0&&s()):b&&"node"===w?h(a,this,c):b||"node"!==w||g(a,this,c)},this.resetFilters=function(){if("connector"===w){for(;U.length>0;)U.pop();this.call(),query_restore=!1,setQueryJSON(this.div_id,this.scope,U),document.getElementsByClassName(u+"-filter_list").length>0&&s()}else O(9,"You cannot run resetFilters on node. Please run it on a Connector")},this.resetDimensions=function(){if("node"===w){for(;this.dimensions.length>0;)j(this.dimensions[this.dimensions.length-1],this),this.dimensions.pop();query_restore=!1,setQueryJSON(this.div_id,this.scope,[])}else O(10,"Connectors do not have dimensions. Please run it on a node")},this.resetDatatypes=function(){if("node"===w){for(;this.datatype.length>0;)this.datatype.pop();query_restore=!1,setQueryJSON(this.div_id,this.scope,[])}else O(11,"Connectors do not have datatypes. Please run it on a node")},this.resetMetrics=function(){if("node"===w){for(var a in this.metrics)j(a,this),delete this.metrics[a];query_restore=!1,setQueryJSON(this.div_id,this.scope,[])}else O(12,"Connectors do not have metrics. Please run it on a node")},this.removeDimensions=function(a){if(K(a)||0===a.length)return O(27,a+": Columns cannot be blank. Kindly pass an array of dimensions"),!1;if(this.dimensions){var b=this.dimensions.length;if(b>0&&(M(this.dimensions,a),b===this.dimensions.length))return!1}return i(a,this),query_restore=!1,setQueryJSON(this.div_id,this.scope,this.filters),!0},this.removeMetrics=function(a){if(K(a)||0===a.length)return O(27,a+": Columns cannot be blank. Kindly pass an array of metrics"),!1;if(this.metrics){var b=Object.keys(this.metrics).length;if(b>0&&(N(this.metrics,a),b===Object.keys(this.metrics).length))return!1}return i(a,this),query_restore=!1,setQueryJSON(this.div_id,this.scope,this.filters),!0},this.destroyColumn=function(a){if("connector"===w){this.removeDimensions([a]),this.removeMetrics([a]);for(var b=$.length,c=0;b>c;c++)window[$[c]].removeDimensions([a]),window[$[c]].removeMetrics([a])}else this.removeDimensions([a]),this.removeMetrics([a])},this.changeColumnName=function(a,b,c){if("connector"===w){k(this,a,b);for(var d=$.length,e=0;d>e;e++)window[$[e]].changeColumnName(a,b,!0)}else if(k(this,a,b),!c)for(var d=$.length,e=0;d>e;e++)window[$[e]].changeColumnName(a,b)},this.addImpacts=function(a,b){if(m(a)){len=a.length;for(var c=0;len>c;c++){$.push(a[c]);var d=window[a[c]];d.impactedby=this.div_id,"node"===this.scope?l(this,a[c]):l(d,this.div_id),b&&(ab.push(a[c]),d.impacts.push(this.div_id),l(d,this.div_id))}}},this.flushToGet=function(){if("node"===w){var a=Q;return Q="",a}O(25,"Cannot call flushToGet to on a Connector PykQuery")},this.call=function(){var a=this;if("node"===w)fb(r(a));else{for(var b=$.length,c=0;b>c;c++){var d=window[$[c]];d.filter_data=d.call()}eb&&this.appendClassSelected()}return!0};var fb=function(a){if(E=p(),B=q(),"inbrowser"===x){var b=new PykQuery.adapter.inbrowser.init(a,B);return Q=b.call(),"node"===w&&C.executeOnFilter(),Q}var b=new PykQuery.adapter.db.init(a,D,B);return b.call(function(a){return Q=a,"node"===w&&C.executeOnFilter(),Q})};this.appendClassSelected=function(){if("connector"===this.scope){if(U){for(var a=document.querySelectorAll(".pykquery-selected"),b=a.length,c=U.length,d=0;b>d;d++)a[d].classList.remove("pykquery-selected");for(var d=0;c>d;d++)for(var e=U[d],f=e.length,g=0;f>g;g++)if(e[g].selected_dom_id){var h=document.querySelectorAll("[data-id='"+e[g].selected_dom_id+"']");h.length>0&&!h[0].classList.contains("pykquery-selected")&&h[0].classList.add("pykquery-selected")}}}else O(26,"Cannot call appendClassSelected() on node")},this.toSql=function(){that=this;var a,b,c=that.filters,d=that.mode,e=that.unique,f=that.metrics,g=that.select,h=that.sort,i=that.dimensions,j=that.limit,k=that.offset,l=that.div_id,m="__",n=that.columns,o=[],p=[],q=[],r="",s="FROM "+m+" ",t=[],u="",v="",w="",x="",y=!1;if(i&&"aggregation"===d){if(f&&!_.isEmpty(f))for(var z in f)for(var A=f[z].length,B=0;A>B;B++)o.push(f[z][B]+"("+z+")");if(!_.isEmpty(i))for(var C=i.length,z=0;C>z;z++)_.has(f,i[z])===!1&&(o.push(i[z]),p.push(i[z]))}if(g&&"select"===d){if(0===_.intersection(n,g).length&&g.toString()!==["*"].toString())return!1;_.each(g,function(a){o.push(a)})}if(e&&"unique"===d){if(0===_.intersection(n,e).length)return!1;_.each(e,function(a){o.push(a)})}if(r=_.isEmpty(o)&&_.isEmpty(i)&&"unique"!=d?"SELECT * ":"unique"===d?"SELECT DISTINCT "+o.join(", ")+" ":"SELECT "+o.join(", ")+" ",c&&!_.isEmpty(c)&&(a=!1,_.each(c,function(d,e){switch(t[e]="",d.condition_type){case"values":b=[],d["in"]&&0!==d["in"].length&&(y=!0,t[e]+=d.column_name+" IN (",_.each(d["in"],function(a){t[e]+=a+", "}),t[e]=t[e].slice(0,-2)+") "),d.not_in&&0!==d.not_in.length&&(t[e]+=y?"AND "+d.column_name+" NOT IN (":d.column_name+" NOT IN (",_.each(d.not_in,function(a){t[e]+=a+", "}),t[e]=t[e].slice(0,-2)+") "),d.next&&e!=c.length-1?(t[e]=t[e]+d.next,a=d.next):a=!1;break;case"range":_.isEmpty(d.condition)||(t[e]+=d.column_name+" ",d.condition.not&&(t[e]+="NOT "),t[e]+="BETWEEN "+d.condition.min+" AND "+d.condition.max+" ",d.next&&e!==c.length-1?(t[e]=t[e]+d.next,a=d.next):a=!1);break;case"data_types":}})),i&&"aggregation"===d&&(u="GROUP BY "+p.join(", ")+" "),h&&!_.isEmpty(h)){v="ORDER BY ";for(key in h)v+=key+" "+h[key]+", ";v=v.slice(0,-2)+" "}w=j?"LIMIT "+j+" ":w,x=k?"OFFSET "+k+" ":x,q=l+": \n "+r+" \n "+s+" \n WHERE";for(var D=t.length,z=0;D>z;z++)q=q+" \n	 "+t[z];return q=q+" \n "+u+" \n "+v+" \n "+w+" \n "+x,console.log(q),q},this.listFilters=function(a){var b=document.getElementById(a);b.innerHTML="",b.innerHTML="<div class='"+u+"-filter_list'></div>",s()}},_.mixin({sum:function(a,b,c){if(!b&&_.isEmpty(a))return 0;var d=0;if(!b&&_.isArray(a)){for(var e=a.length-1;e>-1;e-=1)d+=a[e];return d}return _.each(a,function(a,e,f){var g=b?b.call(c,a,e,f):a;d+=g}),d},avg:function(a,b,c){return!b&&_.isEmpty(a)?1/0:!b&&_.isArray(a)?_.sum(a)/a.length:_.isArray(a)&&!_.isEmpty(a)?_.sum(a,b,c)/a.length:void 0},median:function(a,b,c){if(_.isEmpty(a))return 1/0;var d=[];return!b&&_.isArray(a)?(d=_.clone(a),d.sort(function(a,b){return a-b})):_.isArray(a)&&_.each(a,function(a,e,f){d.push(b?b.call(c,a,e,f):a),d.sort()}),d.length%2?d[Math.floor(d.length/2)]:_.isNumber(d[d.length/2-1])&&_.isNumber(d[d.length/2])?(d[d.length/2-1]+d[d.length/2])/2:d[d.length/2-1]},nrange:function(a,b,c){if(arguments.length<=1){if(0===a)return[];b=a||0,a=0}c=arguments[2]||1*(b>a)||-1;var d=Math.max(Math.ceil((b-a)/c),0),e=0,f=new Array(d);do f[e]=a,a+=c;while((e+=1)<d);return f}}),PykQuery.adapter=PykQuery.adapter||{},PykQuery.adapter.db={},PykQuery.adapter.db.init=function(a,b,c){this.call=function(d){var e;if(!b)return!1;a.filters=c;var f={config:a};e=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),e.onreadystatechange=function(){4!=e.readyState||200!=e.status&&201!=e.status||d(JSON.parse(e.response))},e.open("POST",db_api_endpoint+b+"filter/show",!0),e.send(JSON.stringify(f))}},PykQuery.adapter=PykQuery.adapter||{},PykQuery.adapter.inbrowser={},PykQuery.adapter.inbrowser.init=function(a,b){function c(a){var b=k.sort,c=b.length;return a.sort(function(a,e){for(var f=0;c>f;f++){var g=Object.keys(b[f])[0],h=i(g);if(a[h]!==e[h])return d(a,e,h,b[f][g])}})}function d(a,b,c,d){return"asc"===d?a[c]<b[c]?-1:a[c]>b[c]?1:0:a[c]>b[c]?-1:a[c]<b[c]?1:0}function e(b){var c=b.metrics,d=b.dimensions,e=d.length;local_data=_.groupBy(j,function(a){for(var b="",c=0;e>c;c++){var f=d[c];0===c?b=a[f]:b+="<>"+a[f]}return b});var f=[];return _.map(local_data,function(b,d){for(var e={},g=d.split("<>"),h=g.length,j=0;h>j;j++)e[i(a.dimensions[j])]=g[j];for(var k=Object.keys(c),l=k.length,m=0;l>m;m++)for(var n=c[k[m]],o=n.length,j=0;o>j;j++)switch(n[j]){case"sum":e[i(k[m],n[j])]=_.sum(b,function(a){return parseInt(a[k[m]],10)});break;case"count":e[i(k[m],n[j])]=b.length;break;case"min":e[i(k[m],n[j])]=_.min(b,function(a){return parseInt(a[k[m]],10)})[k[m]];break;case"max":e[i(k[m],n[j])]=_.max(b,function(a){return parseInt(a[k[m]],10)})[k[m]];break;case"avg":e[i(k[m],n[j])]=_.avg(b,function(a){return parseInt(a[k[m]],10)});break;case"median":console.log(b,k),e[i(k[m],n[j])]=_.median(b,function(a){return parseInt(a[k[m]],10)})}k=null,f.push(e)}),f}function f(a){var b,c=a.mode,d=a.filters,e=d.length;b="select"===c?a.select:[];for(var f=0;e>f;f++)switch(d[f].condition_type){case"values":g(d[f],b,c);break;case"range":h(d[f],b);break;case"datatype":}return d=null,j}function g(a,b,c){var d=a["in"],e=a.not_in,f=a.column_name,g=j,h=g.length;j=[];for(var i=0;h>i;i++){var k=g[i][f];d&&d.indexOf(k)>-1?j.push(g[i]):e&&e.length>0&&-1===e.indexOf(k)&&j.push(g[i])}0!=b.length&&"select"===c&&(j=_.map(j,function(a){return _.pick(a,b)})),d=e=f=g=h=null}function h(a,b,c){var d,e,f,g=a.column_name,h=a.condition.length;j=_.filter(j,function(b){for(var c=0;h>c;c++){if(d=a.condition[c].min,e=a.condition[c].max,f=a.condition[c].not,f&&(b[g]>e||b[g]<d))return b;if(!f&&b[g]<=e&&b[g]>=d)return b}}),0!=b.length&&"select"===c&&(j=_.map(j,function(a){return _.pick(a,b)}))}function i(a,b){var c=k.alias;return"string"==typeof c[a]?c[a]:"object"==typeof c[a]?b?c[a][b]:c[a][a]:a}var j,k=a,l=a.connector_divid_for_raw_data,l=window[l];j=l.rawdata,k.filters=b,this.call=function(){var b,d=a.mode;switch(k.filters&&k.filters.length>0&&f(k),d){case"aggregation":b=e(k);break;case"select":break;case"datatype":}return k.sort&&k.sort>0&&(b=c(b)),b}};