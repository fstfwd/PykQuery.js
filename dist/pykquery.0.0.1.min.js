PykUtil={},PykUtil.init=function(){this.pushToArray=function(b,c){return b=a.length?a.push(c):[c]},this.concat_and_uniq=function(a,b){return void 0!=a&&void 0!=b&&(a=a.concat(b).filter(function(a,b,c){return c.indexOf(a)===b})),a},this.is_exactly_same=function(a,b){if(a&&b){var c=a.length===b.length&&a.every(function(a,c){return a===b[c]});return c}return!1},this.subtract_array=function(a,b){if(a&&b){if(0===a.length)return a=void 0;for(var c=b.length,d=0;c>d;d++){var e=a.indexOf(b[d]);if(e>-1&&a.splice(e,1),0===a.length)return a=void 0}}return a},this.subtract_object_attribute=function(a,b){if(a&&b){if(0===Object.keys(a).length)return a=void 0;for(var c=b.length,d=0;c>d;d++)if(a[b[d]]&&delete a[b[d]],0===Object.keys(a).length)return a=void 0}return a},this.isBlank=function(a){return a?!1:!0}};var PykQuery={};PykQuery.global_names=[],PykQuery.local_names=[],PykQuery.query_json={};var queryjson={},query_restore=!0,restoreFilters=function(){for(var a in PykQuery.query_json){for(var b,c=PykQuery.query_json[a],d=window[a],e=c.length,f=0;e>f;f++)b="local"===d.scope?!1:!0,d.addFilter(c[f],b,d.localdividtriggeringevent,!0);if(0===e&&"global"===d.scope){var g=document.getElementsByClassName("filter_list");if(g.length>0){var h=g[0].parentNode.id;d.listFilters(h)}}}};Object.defineProperty(PykQuery,"query_json",{get:function(){return queryjson},set:function(a){queryjson=a,query_restore&&restoreFilters()}});var setQueryJSON=function(a,b,c){PykQuery.query_json[a]=c};PykQuery.init=function(a,b,c,d){var e,f,g,h,i,j,k,l,m=d,n=[],o=["aggregation","unique","select","datatype","global"],p=["local","global"],q=["inbrowser","rumi"],r=["csv","json","array"],s=new PykUtil.init,t=s.isBlank,u=s.concat_and_uniq,v=s.subtract_array,w=s.subtract_object_attribute,x=function(a,b){var c="";100>a&&(c="Visit http://0.0.0.0:4567/#error_"+a),console.error("%c[Error - PykQuery] ","color: red;font-weight:bold;font-size:14px",'("'+b+'"). '+c)},y=function(a,b){console.warn("%c[Warning - PykQuery] ","color: #F8C325;font-weight:bold;font-size:14px",'("'+b+'"). Visit http://0.0.0.0:4567/#warning_'+a)};if(!(o.indexOf(a)>-1&&p.indexOf(b)>-1&&!t(c)&&q.indexOf(d)>-1))return-1===o.indexOf(a)&&x(2,c+": mode has invalid value. It should be one of "+o),-1===p.indexOf(b)&&x(3,c+": scope has invalid value. It should be one of "+p),-1===q.indexOf(d)&&x(4,c+": adapters has invalid value. It should be one of "+q),t(c)&&x(5,c+": DivID cannot be undefined"),!1;if(f=a,g=b,h=d,e="local"===g?c.replace("#",""):c,i="global"===g?_.find(PykQuery.global_names,function(a){return a===e}):null,j="local"===g?_.find(PykQuery.local_names,function(a){return a===e}):null,"global"==f&&"global"!=g)return x(1,e+": scope and mode both should be global"),!1;if(void 0==i&&"global"==g)PykQuery.global_names.push(e),flag=!0;else{if(void 0!=j||"local"!=g)return flag=!1,!1;PykQuery.local_names.push(e),flag=!0}var z,A,B,C,D=[],E=[],F={},G=[],H=[],I=2e3,J=[],K=[],L=0,M={},N=[],O=!0;switch(this.executeOnFilter=function(){},"global"===f&&"global"===g&&"inbrowser"===h&&Object.defineProperty(this,"rawdata",{get:function(){return A},set:function(a){A=a}}),"local"===g&&"inbrowser"===h&&Object.defineProperty(this,"global_divid_for_raw_data",{get:function(){return B},set:function(a){B=a}}),"rumi"===h&&(Object.defineProperty(this,"rumiparams",{get:function(){return m},set:function(a){m=a}}),Object.defineProperty(this,"dataformat",{get:function(){return C},set:function(a){r.indexOf(a.toLowerCase())>-1?C=a:x(6,"The accepted data formats are csv, json and array only. Kindly set a valid data format")}})),Object.defineProperty(this,"scope",{get:function(){return g}}),f){case"select":Object.defineProperty(this,"select",{get:function(){return G},set:function(a){G=a}});break;case"aggregation":Object.defineProperty(this,"dimensions",{get:function(){return E},set:function(a){E=u(E,a)}}),Object.defineProperty(this,"metrics",{get:function(){return F},set:function(a){if($(a))for(var b in a)F[b]=a[b]}});break;case"unique":Object.defineProperty(this,"unique",{get:function(){return G},set:function(a){_.each(a,function(a){G.push(a)})}});break;case"datatype":"datatype"===f&&"local"===g&&"rumi"===h&&Object.defineProperty(this,"datatype",{get:function(){return N},set:function(a){N=u(N,a)}})}Object.defineProperty(this,"div_id",{get:function(){return e}}),Object.defineProperty(this,"localdividtriggeringevent",{get:function(){return k},set:function(a){k=a}}),Object.defineProperty(this,"limit",{get:function(){return I},set:function(a){I=a}}),Object.defineProperty(this,"mode",{get:function(){return f}}),Object.defineProperty(this,"offset",{get:function(){return L},set:function(a){L=a}}),Object.defineProperty(this,"impacts",{get:function(){return J},set:function(a){Y(a)&&J.push(a)}}),Object.defineProperty(this,"impactedby",{get:function(){return K},set:function(a){K.push(a)}}),Object.defineProperty(this,"alias",{get:function(){return M},set:function(a){if(columns=Object.keys(a),columns.length<1)return void y(1,"Need atleast 1 alias name to add.");for(var b in a)M[b]=a[b]}}),Object.defineProperty(this,"sort",{get:function(){return H},set:function(a){for(var b=a.length,c=0;b>c;c++){var d=Object.keys(a[c])[0],e=H.length,f=!1;if(t(d))return void x(8,"Column name is undefined in sort");(t(a[c][d])||"asc"!=a[c][d]&&"desc"!=a[c][d])&&(a[c][d]="asc");for(var g=0;e>g;g++)if(H[g][d]){H[g][d]=a[c][d],f=!0;break}f||(H=u(H,a))}}}),Object.defineProperty(this,"filters",{get:function(){return D},set:function(a){D=a}}),this.addFilter=function(a,b,c,d){var f=document.querySelectorAll("[data-id='"+a.selected_dom_id+"']");return f.length>0&&f[0].classList.contains("pykquery-selected")&&!a.override_filter?void this.removeFilter(a,b):void(Z(a)&&(b&&"global"===g?(P(a,this,d),document.getElementsByClassName("filter_list").length>0&&eb()):b&&"local"===g?(a.local_div_id_triggering_event=e,Q(a,this,d)):b||"local"!==g||P(a,this,d)))};var P=function(a,b,c){for(var d=!0,e=D.length,f=0;e>f;f++){var g=D[f],h=g.condition_type;if(g.column_name===a.column_name&&h===a.condition_type)if("values"===h||"datatype"===h){var i=s.is_exactly_same(a["in"],g["in"]),j=s.is_exactly_same(a.not_in,g.not_in);if(j&&i)return y(2,"Clean up your JS: Same filter cannot add"),!1;var k=s.is_exactly_same(a.not_in,g["in"]),l=s.is_exactly_same(a["in"],g.not_in);if(a.override_filter&&(k||l)){D[f]=a,d=!1,O=!1;break}d=!0,O=!0}else if("range"===h){var m=a.condition,n=g.condition;if(m.min===n.min&&m.max===n.max&&m.not===n.not)return y(2,"Clean up your JS: Same filter cannot add"),!1;if(g.override_filter){D[f]=a,d=!1,O=!1;break}d=!0,O=!0}}d===!0?(D.push(a),b&&"global"===b.scope&&b.call()):O||b.call(),query_restore=c,c||setQueryJSON(b.div_id,b.scope,D),query_restore=!0},Q=function(a){if("local"===g)for(var b=J.length,c=0;b>c;c++)window[J[c]].addFilter(a,!0,e)};this.removeFilter=function(a,b){Z(a)&&(b&&"global"===g?(R(a,this),document.getElementsByClassName("filter_list").length>0&&eb()):b&&"local"===g?S(a,this):b||"local"!==g||R(a,this))};var R=function(a,b){for(var c=a.column_name,d=a.condition_type,e=b.filters,f=0;f<e.length;f++)if(e[f].column_name===c&&e[f].condition_type===d)if("values"===d||"datatype"===d)0===_.difference(e[f].in,a.in).length&&0===_.difference(e[f].not_in,a.not_in).length&&e.splice(f,1),b&&b.call();else if("range"===d){var g=a.condition.min,h=a.condition.max;t(g)||t(h)||g===e[f].condition.min&&h===e[f].condition.max&&(e.splice(f,1),b&&b.call())}query_restore=!1,setQueryJSON(b.div_id,b.scope,e)},S=function(a,b){if("local"===g)for(var c=J.length,d=0;c>d;d++)window[J[d]].removeFilter(a,b)},T=function(a,b){for(var c=D.length,d=a.length,e=0;d>e;e++)U(a[e],b),D=_.reject(D,function(b){return b.column_name==a[e]});D.length!==c&&(document.getElementsByClassName("filter_list").length>0&&eb(),b.call())},U=function(a,b){var c=b.alias,d=b.select,e=b.sort;if(c&&delete c[a],d){var f=d.indexOf(a);f>-1&&d.splice(f,1)}e&&(e=_.reject(e,function(b){return Object.keys(b)[0]==a}))},V=function(a){var b=a.alias,c=a.select,d=a.sort;if(b)for(var e in b)delete b[e];if(c)for(;c.length>0;)c.pop();if(d)for(var e in d)delete d[e]};this.resetFilters=function(){"global"===g?(D=[],this.call(),query_restore=!1,setQueryJSON(this.div_id,this.scope,D),document.getElementsByClassName("filter_list").length>0&&eb()):x(9,"You cannot run resetFilters on local. Please run it on a Global")},this.resetDimensions=function(){if("local"===g){for(;this.dimensions.length>0;)this.dimensions.pop();V(this),query_restore=!1,setQueryJSON(this.div_id,this.scope,[])}else x(10,"Globals do not have dimensions. Please run it on a local")},this.resetDatatypes=function(){if("local"===g){for(;this.datatype.length>0;)this.datatype.pop();query_restore=!1,setQueryJSON(this.div_id,this.scope,[])}else x(11,"Globals do not have datatypes. Please run it on a local")},this.resetMetrics=function(){if("local"===g){for(var a in this.metrics)delete this.metrics[a];V(this),query_restore=!1,setQueryJSON(this.div_id,this.scope,[])}else x(12,"Globals do not have metrics. Please run it on a local")},this.removeDimensions=function(a){if(t(a)||0===a.length)return x(27,a+": Columns cannot be blank. Kindly pass an array of dimensions"),!1;if(this.dimensions){var b=this.dimensions.length;if(b>0&&(v(this.dimensions,a),b===this.dimensions.length))return!1}return T(a,this),query_restore=!1,setQueryJSON(this.div_id,this.scope,this.filters),!0},this.removeMetrics=function(a){if(t(a)||0===a.length)return x(27,a+": Columns cannot be blank. Kindly pass an array of metrics"),!1;if(this.metrics){var b=Object.keys(this.metrics).length;if(b>0&&(w(this.metrics,a),b===Object.keys(this.metrics).length))return!1}return T(a,this),query_restore=!1,setQueryJSON(this.div_id,this.scope,this.filters),!0},this.destroyColumn=function(a){if("global"===g){this.removeDimensions([a]),this.removeMetrics([a]);for(var b=J.length,c=0;b>c;c++)window[J[c]].removeDimensions([a]),window[J[c]].removeMetrics([a])}else this.removeDimensions([a]),this.removeMetrics([a])};var W=function(a,b,c){var d=a.filters;if("local"===g){var e=a.dimensions,f=a.metrics,h=a.alias,i=a.select,j=a.sort;if(e){var k=e.indexOf(b);k>-1&&(e[k]=c)}if(f&&f[b]&&(f[c]=f[b],delete f[b]),h&&h[b]&&(h[b]=h[c],delete h[b]),i){var l=i.indexOf(b);l>-1&&(i[l]=c)}if(j)for(var m=j.length,n=0;m>n;n++)j[n][b]&&(j[n][c]=j[n][b],delete j[n][b])}if(d)for(var o=d.length,n=0;o>n;n++)d[n].column_name===b&&(d[n].column_name=c,document.getElementsByClassName("filter_list").length>0&&eb())};this.changeColumnName=function(a,b,c){if("global"===g){W(this,a,b);for(var d=J.length,e=0;d>e;e++)window[J[e]].changeColumnName(a,b,!0)}else if(W(this,a,b),!c)for(var d=J.length,e=0;d>e;e++)window[J[e]].changeColumnName(a,b)},this.addImpacts=function(a,b){if(Y(a)){len=a.length;for(var c=0;len>c;c++){J.push(a[c]);var d=window[a[c]];d.impactedby=this.div_id,"local"===this.scope?X(this,a[c]):X(d,this.div_id),b&&(K.push(a[c]),d.impacts.push(this.div_id),X(d,this.div_id))}}};var X=function(a,b){a.global_divid_for_raw_data||(a.global_divid_for_raw_data=b)},Y=function(a){var b,c,d=a.length;"local"===g?(error_code=13,b="global"):(error_code=7,b="local");for(var e=0;d>e;e++)if(c=window[a[e]],c&&c.scope===g)return x(error_code,"A "+g+" can only impact a "+b),!1;return!0},Z=function(a){{var b=a.next;a.condition_type}return 0===Object.keys(a).length?(x(14,"Empty filter object is not allowed"),!1):t(a.column_name)?(x(15,"'column_name' cannot be empty"),!1):t(b)||"OR"===b||"AND"===b?"range"===a.condition_type?t(a.condition)?(x(17,"'condition' cannot be empty"),!1):t(a.condition.min)&&t(a.condition.max)?(x(18,"Either 'min' or 'max' or both must always be present"),!1):!0:"values"===a.condition_type||"datatype"===a.condition_type?t(a.not_in)&&t(a["in"])?(x(19,"Either 'in' or 'not_in' or both must always be present with array of some value"),!1):void 0!==a.not_in&&void 0!==a["in"]&&0===a.not_in.length&&0===a["in"].length?(x(19,"Either 'in' or 'not_in' or both must always be present with array of some value"),!1):!0:(x(20,e+": 'condition_type' must be one of "+["range","values","datatype"]),!1):(x(16,"'next' must either be empty or OR or AND"),!1)},$=function(a){var b=["min","max","avg","sum","median","count"];if(0===Object.keys(a).length)return x(21,"'metrics' object cannot be empty"),!1;for(var c in a){if(t(c))return x(22,"Column name is undefined in 'metrics'"),!1;if(t(a[c])||0===a[c].length)return x(23,"Please pass an Array of aggregation functions for column name '"+c),!1;for(var d=a[c].length,e=0;d>e;e++)if(b.indexOf(a[c][e])<=-1)return x(24,"Wrong aggregation function passed for column name '"+c),!1}return!0};this.flushToGet=function(){if("local"===g){var a=z;return z="",a}x(25,"Cannot call flushToGet to on a Global PykQuery")},this.call=function(){var a=this;if("local"===g)cb(db(a)),this.executeOnFilter();else{for(var b=J.length,c=0;b>c;c++){var d=window[J[c]];d.filter_data=d.call()}O&&this.appendClassSelected()}return!0};var ab=function(){for(var a,b,c=JSON.parse(JSON.stringify(window[e].filters)),d=K.length,f=0;d>f;f++){a=window[K[f]].filters,b=a.length;for(var g=0;b>g;g++)a[g]&&a[g].local_div_id_triggering_event!==e&&c.push(a[g])}return c},bb=function(){if(Object.keys(PykQuery.query_json).length>0&&(l=[]),n&&n.length>0){l=[];var a=_.groupBy(n,function(a){return a.column_name+"-"+a.condition_type});for(var b in a){var c=a[b],d=c.length,e={column_name:c[0].column_name,condition_type:c[0].condition_type,local_div_id_triggering_event:c[0].local_div_id_triggering_event,next:c[0].next};if("values"===c[0].condition_type||"datatype"===c[0].condition_type){for(var f=[],g=[],h=0;d>h;h++)f=c[h].in?u(f,c[h].in):f,g=c[h].not_in?u(g,c[h].not_in):g;e.in=f,e.not_in=g}else if("range"===c[0].condition_type){e.condition=[];for(var h=0;d>h;h++)e.condition.push({min:c[h].condition.min,max:c[h].condition.max,not:c[h].condition.not})}l.push(e)}}return l},cb=function(a){if(n=ab(),l=bb(),"inbrowser"===h){var b=new PykQuery.adapter.inbrowser.init(a,l);return z=b.call()}var b=new PykQuery.adapter.rumi.init(a,m,l);return b.call(function(a){return z=a})},db=function(a){for(var b={},c=Object.getOwnPropertyNames(a),d=c.length,e=0;d>e;e++)a.propertyIsEnumerable(c[e])===!1&&(b[c[e]]=a[c[e]]);return b};this.appendClassSelected=function(){if("global"===this.scope){if(D){for(var a=document.querySelectorAll(".pykquery-selected"),b=a.length,c=D.length,d=0;b>d;d++)a[d].classList.remove("pykquery-selected");for(var d=0;c>d;d++)if(D[d].selected_dom_id){var e=document.querySelectorAll("[data-id='"+D[d].selected_dom_id+"']");e.length>0&&!e[0].classList.contains("pykquery-selected")&&e[0].classList.add("pykquery-selected")}}}else x(26,"Cannot call appendClassSelected() on local")},this.toSql=function(){that=this;var a,b,c=that.filters,d=that.mode,e=that.unique,f=that.metrics,g=that.select,h=that.sort,i=that.dimensions,j=that.limit,k=that.offset,l=that.div_id,m="__",n=that.columns,o=[],p=[],q=[],r="",s="FROM "+m+" ",t=[],u="",v="",w="",x="",y=!1;if(i&&"aggregation"===d){if(f&&!_.isEmpty(f))for(var z in f)for(var A=f[z].length,B=0;A>B;B++)o.push(f[z][B]+"("+z+")");if(!_.isEmpty(i))for(var C=i.length,z=0;C>z;z++)_.has(f,i[z])===!1&&(o.push(i[z]),p.push(i[z]))}if(g&&"select"===d){if(0===_.intersection(n,g).length&&g.toString()!==["*"].toString())return!1;_.each(g,function(a){o.push(a)})}if(e&&"unique"===d){if(0===_.intersection(n,e).length)return!1;_.each(e,function(a){o.push(a)})}if(r=_.isEmpty(o)&&_.isEmpty(i)&&"unique"!=d?"SELECT * ":"unique"===d?"SELECT DISTINCT "+o.join(", ")+" ":"SELECT "+o.join(", ")+" ",c&&!_.isEmpty(c)&&(a=!1,_.each(c,function(d,e){switch(t[e]="",d.condition_type){case"values":b=[],d["in"]&&0!==d["in"].length&&(y=!0,t[e]+=d.column_name+" IN (",_.each(d["in"],function(a){t[e]+=a+", "}),t[e]=t[e].slice(0,-2)+") "),d.not_in&&0!==d.not_in.length&&(t[e]+=y?"AND "+d.column_name+" NOT IN (":d.column_name+" NOT IN (",_.each(d.not_in,function(a){t[e]+=a+", "}),t[e]=t[e].slice(0,-2)+") "),d.next&&e!=c.length-1?(t[e]=t[e]+d.next,a=d.next):a=!1;break;case"range":_.isEmpty(d.condition)||(t[e]+=d.column_name+" ",d.condition.not&&(t[e]+="NOT "),t[e]+="BETWEEN "+d.condition.min+" AND "+d.condition.max+" ",d.next&&e!==c.length-1?(t[e]=t[e]+d.next,a=d.next):a=!1);break;case"data_types":}})),i&&"aggregation"===d&&(u="GROUP BY "+p.join(", ")+" "),h&&!_.isEmpty(h)){v="ORDER BY ";for(key in h)v+=key+" "+h[key]+", ";v=v.slice(0,-2)+" "}w=j?"LIMIT "+j+" ":w,x=k?"OFFSET "+k+" ":x,q=l+": \n "+r+" \n "+s+" \n WHERE";for(var D=t.length,z=0;D>z;z++)q=q+" \n	 "+t[z];return q=q+" \n "+u+" \n "+v+" \n "+w+" \n "+x,console.log(q),q},this.listFilters=function(a){var b=document.getElementById(a);b.innerHTML="",b.innerHTML="<div class='filter_list'></div>",eb()};var eb=function(){var a=document.getElementsByClassName("filter_list")[0];a.innerHTML="";for(var b=D.length,c=0;b>c;c++){if(D[c].in)var d="<b>"+D[c].column_name+" IN</b> ("+D[c].in+")";else if(D[c].not_in)var d="<b>"+D[c].column_name+" NOT IN</b> ("+D[c].not_in+")";else if(D[c].condition)var d="<b>"+D[c].column_name+" BETWEEN</b> "+D[c].condition.min.toFixed(2)+" <b>AND</b> "+D[c].condition.max.toFixed(2);var e=document.createElement("div");e.setAttribute("class","filter_block"),e.setAttribute("style","padding: 0px 10px;"),e.setAttribute("id","filter_block"+c),a.appendChild(e);var f=document.createElement("div");f.setAttribute("class","filter_value"),f.innerHTML=d,document.getElementById("filter_block"+c).appendChild(f);var g=document.createElement("div");g.setAttribute("class","filter_remove"),g.setAttribute("id","filter_remove_"+c),g.innerHTML="<b class='glyphicon glyphicon-trash' style='font-size: 11px;'></b>",document.getElementById("filter_block"+c).appendChild(g)}for(var h=document.getElementsByClassName("filter_remove"),i=h.length,c=0;i>c;c++)h[c].onclick=function(){var a=this.id.split("_");fb(D[a[2]])}},fb=function(a){var b=a.local_div_id_triggering_event;window[b].removeFilter(a,!0)}},PykQuery.adapter=PykQuery.adapter||{},PykQuery.adapter.rumi={},PykQuery.adapter.rumi.init=function(a,b,c){this.call=function(d){if(!b)return!1;a.filters=c;var e={config:a,token:gon.token};$.ajax({url:rumi_api_endpoint+b+"filter/show",data:e,dataType:"json",type:"POST",async:!1,success:function(a){d(a)},error:function(){console.log("Save error.")}})}},_.mixin({sum:function(a,b,c){if(!b&&_.isEmpty(a))return 0;var d=0;if(!b&&_.isArray(a)){for(var e=a.length-1;e>-1;e-=1)d+=a[e];return d}return _.each(a,function(a,e,f){var g=b?b.call(c,a,e,f):a;d+=g}),d},mean:function(a,b,c){return!b&&_.isEmpty(a)?1/0:!b&&_.isArray(a)?_.sum(a)/a.length:_.isArray(a)&&!_.isEmpty(a)?_.sum(a,b,c)/a.length:void 0},median:function(a,b,c){if(_.isEmpty(a))return 1/0;var d=[];return!b&&_.isArray(a)?(d=_.clone(a),d.sort(function(a,b){return a-b})):_.isArray(a)&&each(a,function(a,e,f){d.push(b?b.call(c,a,e,f):a),d.sort()}),d.length%2?d[Math.floor(d.length/2)]:_.isNumber(d[d.length/2-1])&&_.isNumber(d[d.length/2])?(d[d.length/2-1]+d[d.length/2])/2:d[d.length/2-1]},nrange:function(a,b,c){if(arguments.length<=1){if(0===a)return[];b=a||0,a=0}c=arguments[2]||1*(b>a)||-1;var d=Math.max(Math.ceil((b-a)/c),0),e=0,f=new Array(d);do f[e]=a,a+=c;while((e+=1)<d);return f}}),PykQuery.adapter=PykQuery.adapter||{},PykQuery.adapter.inbrowser={},PykQuery.adapter.inbrowser.init=function(a,b){var c,d=a,e=a.global_divid_for_raw_data,e=window[e];c=e.rawdata,d.filters=b,this.call=function(){var b,c=a.mode;switch(d.filters&&d.filters.length>0&&i(d),c){case"aggregation":b=h(d);break;case"unique":break;case"datatype":}return d.sort&&(b=f(b)),b};var f=function(a){var b=d.sort,c=b.length;return a.sort(function(a,d){for(var e=0;c>e;e++){var f=Object.keys(b[e])[0],h=l(f);if(a[h]!==d[h])return g(a,d,h,b[e][f])}})},g=function(a,b,c,d){return"asc"===d?a[c]<b[c]?-1:a[c]>b[c]?1:0:a[c]>b[c]?-1:a[c]<b[c]?1:0},h=function(b){var d=b.metrics,e=b.dimensions,f=e.length;local_data=_.groupBy(c,function(a){for(var b="",c=0;f>c;c++){var d=e[c];0===c?b=a[d]:b+="<>"+a[d]}return b});var g=[];return _.map(local_data,function(b,c){for(var e={},f=c.split("<>"),h=f.length,i=0;h>i;i++)e[l(a.dimensions[i])]=f[i];for(var j=Object.keys(d),k=j.length,m=0;k>m;m++)for(var n=d[j[m]],o=n.length,m=0;o>m;m++)switch(n[m]){case"count":e[l(j[m],n[m])]=b.length;break;case"sum":e[l(j[m],n[m])]=_.sum(b,function(a){return parseInt(a[j[m]],10)})}g.push(e)}),g},i=function(a){var b,d=a.mode,e=a.filters,f=e.length;b="select"===d?a.select:[];for(var g=0;f>g;g++)switch(e[g].condition_type){case"values":j(e[g],b,d);break;case"range":k(e[g],b);break;case"datatype":}return c},j=function(a,b,d){var e=a["in"],f=a.not_in,g=a.column_name,h=c,i=h.length;c=[];for(var j=0;i>j;j++){var k=h[j][g];(!f||f.indexOf(k)<0)&&e&&e.indexOf(k)>-1&&c.push(h[j])}0!=b.length&&"select"===d&&(c=_.map(c,function(a){return _.pick(a,b)}))},k=function(a,b,d){var e,f,g=a.column_name,h=a.condition.length;c=_.filter(c,function(b){for(var c=0;h>c;c++)if(e=a.condition[c].min,f=a.condition[c].max,b[g]<=f&&b[g]>=e)return b}),0!=b.length&&"select"===d&&(c=_.map(c,function(a){return _.pick(a,b)}))},l=function(a,b){var c=d.alias;return"string"==typeof c[a]?c[a]:"object"==typeof c[a]?b?c[a][b]:c[a][a]:a}};